\documentclass[main.tex]{subfiles}
\begin{document}

\chapter{Method}
In this chapter Krotov's method for quantum optimal control will be briefly introduced and an implementation as a Python package.
Then the numerical experiments will be explained.

\section{Krotov's Method for quantum optimal control}
Krotov's method fundamentally relies on the variational principle to minimize a functional \[ J\qty[\qty{\ket{\phi^{(i)}_k(t)}},\qty{\epsilon_l^{(i)}(t)}] \] where the constraints are included as Lagrange multipliers \cite{goerz_krotov:_2019}.
A detailed explanation of this functional when the method is applied to quantum systems can be found in \autocite{reich_monotonically_2012}. 

\subsection{Krotov: the Python package}
A Python implementation of the Krotov package is available at \url{https://krotov.readthedocs.io/en/latest/}. It provides simple functions and objects to


\section{Optimization Experiments}
In this chapter the numerical optimization experiments are presented and motivated.
\subsection{Hamiltonian}
To test the method, the anharmonic oscillator in~\cref{eq:resonator-hamiltonian} will be chosen as it is often used as the physical realisation of a qubit.
Throughout this thesis, such a system will be referred to as a qubit even though it has more than two energy levels.
Consequently, the resonance frequency of the qubit \( \omega_{01} \) refers to the transition between \( \ket{0} \) and \( \ket{1} \).
To induce transitions between these states, control pulse terms are added to~\cref{eq:resonator-hamiltonian}
\begin{equation}
    \Ham = \omega_{01} \au\ad + \frac{\kappa}{2} \qty(\au\ad)^2 + \Omega(t)\ex^{i\omega_{01}t}\ad + \Omega^*(t)\ex^{-i\omega_{01}t}\au
    \label{eq:system-hamiltonian}
\end{equation}
where \( \Omega(t) \) is the complex amplitude of the control pulse.
Looking at the Hamiltonian above it can be argued that it can be written in the form in \cref{eq:optimal-control-hamiltonian} with \( u_0(t) = \Omega(t)\ex^{i\omega_{01}t} \) and \( u_1(t) = \Omega^*(t)\ex^{-i\omega_{01}t} \).
However, there are two problems that need to be adressed.
Firstly, the oscillating factors will require an unnecessarily fine time discretization of the pulses.
Secondly, the Krotov package expects real-valued pulse amplitudes \( \qty{u_i(t)} \) as inputs.
The first problem can be avoided by transforming the Hamiltonian into the interaction picture.
Choosing \( H_A = \omega_{01} \au\ad \), \cref{eq:system-hamiltonian} transforms\footnote{Full derivation is shown in \cref{sec:appendix-interaction-picture}} into
\begin{equation}
    \Ham \rightarrow~ \frac{\kappa}{2}\qty(\au\ad)^2 + \Omega(t)\ad + \Omega^*(t)\au.
\end{equation}
Now the pulse amplitudes are \( u_0(t) = \Omega(t) \) and \( u_1(t) = \Omega^*(t) \), i.e.\ the envelope of the physical control pulse which varies significantly slower than the actual pulse.
The second problem can now be easily fixed with a rearrangment of the terms
\[ \Omega(t)\ad + \Omega^*(t)\au = \bigg[\text{Re}\qty[\Omega(t)]+i\text{Im}\qty[\Omega(t)]\bigg]\ad + \bigg[\text{Re}\qty[\Omega(t)]-i\text{Im}\qty[\Omega(t)]\bigg]\au = \]
\[ = \text{Re}\qty[\Omega(t)]\qty(\ad + \au) + \text{Im}\qty[\Omega(t)]i\qty(\ad - \au). \]
For intuition, \( \qty(\ad + \au) \) and \( i\qty(\ad - \au) \) correspond to Bloch sphere rotations around the x-axis and y-axis respectively. 
This leaves us with the final Hamiltonian
\begin{equation}
    \Ham = \underbrace{\kappa/2\qty(\au\ad)^2}_{\Ham_d} + \underbrace{\text{Re}\qty[\Omega(t)]}_{u_0(t)}\underbrace{(\ad + \au)}_{\Ham_0} + \underbrace{\text{Im}\qty[\Omega(t)]}_{u_1(t)}\underbrace{i(\ad - \au)}_{\Ham_1} .
    \label{eq:system-hamiltonian-rotating}
\end{equation}

The parameters of the qubit are chosen to model real superconducting qubits with \( \kappa = -2\pi\times\SI{297}{\mega\hertz} \) (and \( \omega_{01} = 2\pi\times\SI{6.2815}{\giga\hertz} \)).
The system Hamiltonian~\eqref{eq:system-hamiltonian-rotating} is simulated with a Hilbert space size conveniently chosen to be \( L = 3 \).
A smaller Hilbert space, and consequently smaller matrices, requires less computations but could possibly be a poor approximation of the Hamiltonian.
This, however, is not a problem in this case as we can neglect % TODO why can we neglect?

\subsection{Optimization Setup}
The goal of the optimization is to realise state transfers which will be presented in their own respective sections below.
However the common setup options will be presented here.

To simulate the constraints of physical \textbf{a}rbitrary \textbf{w}aveform \textbf{g}enerators a maximum sample rate of \SI{4}{\giga\samples\per\second} is added.
Recall that the physcal pulses oscillate at \( \omega_{01} = \SI{6.2815}{\giga\hertz} \), a rate which \SI{4}{\giga\samples\per\second} can never resolve.
AWGs with higher sample rates than \SI{4}{\giga\samples\per\second} are costly, but the rotating frame transformation permits the use of an AWG to generate the pulse envelopes \( \Omega(t) \) and a tone generator to create a carrier signal at \( \omega_{01} \).
These signals can then be combined in a mixer.
Thus the generated pulses can (eventually) be used in experimental settings.
Further, due to the noise sensitivity of superconducting systems an amplitude constraint is needed to keep the system cool.
Some derivation is required to set a realistic maximum amplitude \( A_m \).
First the maximum amplitude is chosen with the assumption that a truncated gaussian pulse
\begin{equation}
    g(t) = \frac{1}{\sigma\sqrt{2\pi}} \ex^{-\frac{1}{2}\qty(\frac{t}{\sigma})^2}
\end{equation}
with \( \sigma = \ns{3} \) can physically realise a \(\pi\)-rotation \( \ket{0} \rightarrow \ket{1} \) in a planar transmon qubit.

Krotov gives a Blackman pulse
Blackman pulses are a window function 
A Blackman pulse with a total length of \(6\sigma\) is a good approximation of a Gaussian pulse.

\begin{equation}
    A(\sigma) = \frac{C}{\text{max}(\sigma,3)\sqrt{2\pi}}
\end{equation}
we can use this to determine the maximum amplitude and 

Guess pulses half amplitude (actually blackman pulses)

convergence criteria
fidelity \(F\)
change between iterations falls below a certain critera \(\Delta F\)

\subsection{\texorpdfstring{\boldmath\(\ket{0}\rightarrow\ket{1}\)}{0 -> 1} state transfer}
Pulse shapes were optimized with varying lengths from \SI{4.25}{\nano\second} to \SI{30}{\nano\second} with convergence criteria \(F>0.99999\) or \(\Delta F < \num{e-07}\). Step size \(\lambda = \frac{1}{\frac{1}{2}A_{m}}\)

\subsection{\texorpdfstring{\boldmath\(\ket{0}\rightarrow\ket{2}\)}{0 -> 2} state transfer}
Pulse shapes were optimized with varying lengths from \SI{22}{\nano\second} to \SI{30}{\nano\second} with convergence criteria \(F>0.99999\) or \(\Delta F < \num{e-09}\). Step size \(\lambda = \frac{1}{2A_{m}}\)

\subsection{\texorpdfstring{\boldmath\( \ket{1}_q\ket{0}_r\rightarrow\ket{0}_q\ket{C_1}_r \)}{10 -> 0C1} state transfer}


\end{document}
